# ğŸ“± Lys&Co App

Application mobile React Native (Expo) connectÃ©e Ã  Supabase.

Elle permet aux utilisateurs :
âœ… de se connecter / sâ€™inscrire,  
âœ… de gÃ©rer leur profil,  
âœ… de consulter leurs documents, rÃ©servations, abonnements, factures,  
âœ… de supprimer leur compte,  
âœ… et aux admins de consulter certaines donnÃ©es.

---

## ğŸš€ Stack technique

- **Frontend** : React Native (Expo)
- **Backend** : Supabase (PostgreSQL, Auth, RLS, Storage)
- **Paiement** : Stripe (via backend Node.js)
- **SÃ©curitÃ©** : RLS activÃ©, policies spÃ©cifiques

---

## âš™ï¸ Configuration

1ï¸âƒ£ Variables dâ€™environnement (`.env` ou Expo config)

```
EXPO_PUBLIC_APP_URL=https://ton-app-frontend.com
SUPABASE_URL=https://xxxx.supabase.co
SUPABASE_PUBLIC_ANON_KEY=...
BACKEND_NODE_URL=https://ton-backend-node.vercel.app
```

2ï¸âƒ£ Supabase (table `profiles`) policies Ã  activer :

- âœ… SELECT : Users can view own profile â†’ `auth.uid() = id`
- âœ… INSERT : Users can insert own profile â†’ `auth.uid() = id` _(ou plus simple : `true` mais âš  sÃ©curitÃ© en prod)_
- âœ… UPDATE : Users can update own profile â†’ `auth.uid() = id`

---

## ğŸ”‘ FonctionnalitÃ©s principales

- **Authentification** : email + mot de passe (via Supabase)
- **Dashboard utilisateur** :
  - Affiche nom, email, tÃ©lÃ©phone, entreprise
  - Modification du profil
  - Suppression dÃ©finitive du compte
- **Documents utilisateurs**
- **RÃ©servations de salles**
- **Abonnements Stripe**
- **Factures Stripe**
- **Portail Stripe pour gestion des abonnements**

---

## ğŸ“‚ Arborescence clÃ©

```
/src
  /components
    /dashboard â†’ composants du tableau de bord
    /ui â†’ composants UI rÃ©utilisables
  /hooks
    useUserData.tsx â†’ gestion des donnÃ©es utilisateur
  /integrations
    supabase â†’ client Supabase
  /navigation
    types.ts â†’ types navigation React Navigation
```

---

## âš ï¸ Notes importantes

- Les policies `WITH CHECK (true)` permettent Ã  tous les `authenticated` dâ€™insÃ©rer â†’ idÃ©al en dev, mais en prod sÃ©curiser avec :

  ```sql
  WITH CHECK (auth.uid() = id)
  ```

- Tester `select auth.uid();` sur Supabase SQL Editor pour sâ€™assurer que le token est bien passÃ©.

- Si `auth.uid()` retourne `null` â†’ vÃ©rifier :
  - token cÃ´tÃ© client,
  - headers envoyÃ©s,
  - configuration du Supabase client (ex. `persistSession` et `storage` pour React Native).

---

## ğŸ’¬ Commandes utiles

```bash
# Lancer Expo
npx expo start

# GÃ©nÃ©rer une build Android
eas build --platform android

# GÃ©nÃ©rer une build iOS
eas build --platform ios

# Lancer le backend Node local
npm run dev
```
