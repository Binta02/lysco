{
    "sourceFile": "screens/Confirmation.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754298356177,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754298356177,
            "name": "Commit-0",
            "content": "import Footer from \"@/src/components/Footer\";\r\nimport { MaterialCommunityIcons } from \"@expo/vector-icons\";\r\nimport { Session } from \"@supabase/supabase-js\";\r\nimport { useLocalSearchParams, useRouter } from \"expo-router\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport ContractGenerator from \"../src/components/contract/ContractGenerator\";\r\n\r\nimport {\r\n  ScrollView,\r\n  StyleSheet,\r\n  Text,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"react-native\";\r\n\r\ntype OrderItem = {\r\n  title: string;\r\n  price: number;\r\n  quantity: number;\r\n};\r\n\r\ntype ClientInfo = {\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  companyName?: string;\r\n  siretNumber?: string;\r\n  address: string;\r\n  addressDetails?: string;\r\n  city: string;\r\n  postalCode: string;\r\n};\r\n\r\nconst Confirmation = () => {\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const router = useRouter();\r\n  const { orderJson } = useLocalSearchParams();\r\n  const [order, setOrder] = useState<any>(null);\r\n  const [session, setSession] = useState<Session | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!orderJson) {\r\n      router.replace(\"/\");\r\n    } else {\r\n      const parsedOrder = JSON.parse(orderJson as string);\r\n      setOrder(parsedOrder);\r\n    }\r\n  }, [orderJson]);\r\n\r\n  if (!order) return null;\r\n\r\n  const { orderId, items, subtotal, tax, total, clientInfo } = order;\r\n\r\n  const domiciliationItems = items.filter((item: OrderItem) => {\r\n    const title = item.title\r\n      .toLowerCase()\r\n      .normalize(\"NFD\")\r\n      .replace(/[\\u0300-\\u036f]/g, \"\");\r\n    return (\r\n      title.includes(\"domicili\") ||\r\n      title.includes(\"entreprise\") ||\r\n      title.includes(\"auto-entrepreneur\") ||\r\n      title.includes(\"association\")\r\n    );\r\n  });\r\n\r\n  const domiciliationItem =\r\n    domiciliationItems.length > 0 ? domiciliationItems[0] : null;\r\n\r\n  return (\r\n    <View style={{ flex: 1, backgroundColor: \"#fff\" }}>\r\n      <ScrollView contentContainerStyle={styles.container}>\r\n        <View style={{ padding: 16 }}>\r\n          <View style={styles.header}>\r\n            <View style={styles.checkIcon}>\r\n              <MaterialCommunityIcons\r\n                name=\"check-circle\"\r\n                size={40}\r\n                color=\"#16a34a\"\r\n              />\r\n            </View>\r\n            <Text style={styles.title}>Commande confirmée</Text>\r\n            <Text style={styles.subtitle}>\r\n              Vous trouverez les informations de votre commande ci-dessous.\r\n              {\"\\n\"}\r\n              Votre facture sera disponible dans votre espace personnel.\r\n            </Text>\r\n          </View>\r\n\r\n          <View style={styles.card}>\r\n            <Text style={styles.cardTitle}>\r\n              Détails de la commande{\" \"}\r\n              <Text style={styles.orderId}>#{orderId}</Text>\r\n            </Text>\r\n\r\n            {/* Articles */}\r\n            <View style={styles.section}>\r\n              <Text style={styles.sectionTitle}>Articles</Text>\r\n              {items.map((item: any, index: number) => (\r\n                <View key={index} style={styles.row}>\r\n                  <View>\r\n                    <Text>{item.title}</Text>\r\n                    <Text style={styles.smallText}>\r\n                      Quantité: {item.quantity}\r\n                    </Text>\r\n                  </View>\r\n                  <Text style={styles.boldText}>\r\n                    {(item.price * item.quantity).toFixed(2)} €\r\n                  </Text>\r\n                </View>\r\n              ))}\r\n            </View>\r\n\r\n            {/* Totaux */}\r\n            <View style={styles.section}>\r\n              <View style={styles.row}>\r\n                <Text>Sous-total</Text>\r\n                <Text>{subtotal.toFixed(2)} €</Text>\r\n              </View>\r\n              <View style={styles.row}>\r\n                <Text>TVA (20%)</Text>\r\n                <Text>{tax.toFixed(2)} €</Text>\r\n              </View>\r\n              <View style={[styles.row, styles.totalRow]}>\r\n                <Text style={styles.boldText}>Total</Text>\r\n                <Text style={styles.boldText}>{total.toFixed(2)} €</Text>\r\n              </View>\r\n            </View>\r\n\r\n            {/* Informations client */}\r\n            <View style={styles.section}>\r\n              <Text style={styles.sectionTitle}>Informations client</Text>\r\n              <Text>\r\n                Nom : {clientInfo.firstName} {clientInfo.lastName}\r\n              </Text>\r\n              <Text style={styles.smallText}>Mail : {clientInfo.email}</Text>\r\n              {clientInfo.companyName ? (\r\n                <Text style={styles.smallText}>\r\n                  Entreprise : {clientInfo.companyName}\r\n                </Text>\r\n              ) : null}\r\n              {clientInfo.siretNumber ? (\r\n                <Text style={styles.smallText}>\r\n                  SIRET: {clientInfo.siretNumber}\r\n                </Text>\r\n              ) : null}\r\n              <Text style={styles.smallText}>\r\n                Adresse : {clientInfo.address}\r\n              </Text>\r\n              {clientInfo.addressDetails ? (\r\n                <Text style={styles.smallText}>\r\n                  {clientInfo.addressDetails}\r\n                </Text>\r\n              ) : null}\r\n              <Text style={styles.smallText}>\r\n                {clientInfo.city}, {clientInfo.postalCode}\r\n              </Text>\r\n            </View>\r\n\r\n            {/* Contrat de domiciliation */}\r\n            {domiciliationItem && (\r\n              <View style={styles.section}>\r\n                <Text style={styles.sectionTitle}>\r\n                  Votre contrat de domiciliation\r\n                </Text>\r\n                <Text style={styles.smallText}>\r\n                  Il est impératif de télécharger votre contrat de domiciliation\r\n                  maintenant. Vous ne pourrez plus y accéder par la suite, sauf\r\n                  en repassant commande ou en venant à l’agence.\r\n                </Text>\r\n                <View style={styles.warningBox}>\r\n                  <Text style={styles.boldText}>⚠ Attention :</Text>\r\n                  <Text style={styles.smallText}>\r\n                    Merci de bien vouloir retourner le contrat signé accompagné\r\n                    des documents suivants :\r\n                  </Text>\r\n                  <Text style={styles.smallText}>\r\n                    • Pièce d’identité : Copie valide.\r\n                  </Text>\r\n                  <Text style={styles.smallText}>\r\n                    • Justificatif de domicile : Document de moins de 3 mois.\r\n                  </Text>\r\n                  <Text style={styles.smallText}>\r\n                    Ces documents sont nécessaires pour compléter votre\r\n                    inscription.\r\n                  </Text>\r\n                </View>\r\n              </View>\r\n            )}\r\n            {domiciliationItem && (\r\n              <ContractGenerator\r\n                data={{\r\n                  ...clientInfo,\r\n                  fullName: `${clientInfo.firstName} ${clientInfo.lastName}`,\r\n                  planName: domiciliationItem.title,\r\n                  planPrice: domiciliationItem.price,\r\n                  businessActivity:\r\n                    clientInfo.businessActivity || \"Non précisé\",\r\n                }}\r\n              />\r\n            )}\r\n          </View>\r\n\r\n          {/* Bouton continuer achats */}\r\n          <View style={{ alignItems: \"center\", marginTop: 20 }}>\r\n            <TouchableOpacity\r\n              style={styles.continueButton}\r\n              onPress={() => router.push(\"/\")}\r\n            >\r\n              <MaterialCommunityIcons name=\"shopping\" size={20} color=\"#fff\" />\r\n              <Text style={styles.continueButtonText}>\r\n                Continuer vos achats\r\n              </Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n        <Footer />\r\n      </ScrollView>\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default Confirmation;\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    // flex: 1,\r\n    paddingBottom: 50, // pour éviter que le contenu soit coupé sous le Footer\r\n  },\r\n  header: {\r\n    alignItems: \"center\",\r\n    marginBottom: 24,\r\n  },\r\n  checkIcon: {\r\n    backgroundColor: \"#dcfce7\",\r\n    borderRadius: 40,\r\n    width: 64,\r\n    height: 64,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    marginBottom: 12,\r\n  },\r\n  title: {\r\n    fontSize: 24,\r\n    fontWeight: \"bold\",\r\n    marginBottom: 4,\r\n    textAlign: \"center\",\r\n  },\r\n  subtitle: {\r\n    textAlign: \"center\",\r\n    color: \"#6b7280\",\r\n    fontSize: 14,\r\n  },\r\n  card: {\r\n    backgroundColor: \"#fff\",\r\n    padding: 16,\r\n    borderRadius: 12,\r\n    shadowColor: \"#000\",\r\n    shadowOpacity: 0.05,\r\n    shadowOffset: { width: 0, height: 2 },\r\n    elevation: 2,\r\n  },\r\n  cardTitle: {\r\n    fontSize: 18,\r\n    fontWeight: \"bold\",\r\n    marginBottom: 12,\r\n  },\r\n  orderId: {\r\n    fontSize: 12,\r\n    color: \"#6b7280\",\r\n    fontWeight: \"normal\",\r\n  },\r\n  section: {\r\n    marginTop: 12,\r\n    borderTopWidth: 1,\r\n    borderTopColor: \"#e5e7eb\",\r\n    paddingTop: 12,\r\n  },\r\n  sectionTitle: {\r\n    fontWeight: \"bold\",\r\n    marginBottom: 8,\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n    justifyContent: \"space-between\",\r\n    marginBottom: 8,\r\n  },\r\n  totalRow: {\r\n    paddingTop: 8,\r\n    borderTopWidth: 1,\r\n    borderTopColor: \"#e5e7eb\",\r\n  },\r\n  smallText: {\r\n    fontSize: 12,\r\n    color: \"#2b2c2dff\",\r\n  },\r\n  boldText: {\r\n    fontWeight: \"bold\",\r\n  },\r\n  warningBox: {\r\n    backgroundColor: \"#fef9c3\",\r\n    borderLeftWidth: 4,\r\n    borderLeftColor: \"#facc15\",\r\n    padding: 12,\r\n    marginTop: 12,\r\n  },\r\n  continueButton: {\r\n    backgroundColor: \"#5cb9bc\",\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    paddingVertical: 12,\r\n    paddingHorizontal: 24,\r\n    borderRadius: 24,\r\n  },\r\n  continueButtonText: {\r\n    color: \"#fff\",\r\n    fontWeight: \"bold\",\r\n    marginLeft: 8,\r\n  },\r\n});\r\n"
        }
    ]
}